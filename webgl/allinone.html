<html>
<head>
<script src="webgl-debug.js"></script>
<script type="text/javascript">
	function get_webgl_context() {
		var canvas = document.getElementById('mycanvas');
		var gl;
		if (canvas.getContext) {
			try {
				gl = canvas.getContext("webgl") ||
					canvas.getContext("experimental-webgl");
			}
			catch(e) {
				alert( "getting gl context threw exception" );
			}
		} else {
			alert( "can't get context" );
		}
		
		gl = WebGLDebugUtils.makeDebugContext(gl);
		
		return gl;
	}
	
	function draw() {
		var gl = get_webgl_context();
		
		gl.clearColor(0,0,0,1);
		gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
		
		var array = new Float32Array([0,0,0, 1,0,0, 1,1,0]);
		var buffer = gl.createBuffer();
		gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
		gl.bufferData(gl.ARRAY_BUFFER, array, gl.STATIC_DRAW);
		
		var indexArray = new Uint16Array([0,1,2]);
		var indexBuffer = gl.createBuffer();
		gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer);
		gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indexArray, gl.STATIC_DRAW);
		
		var program = gl.createProgram();
		
		var vertexShader = gl.createShader(gl.VERTEX_SHADER);
		var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);
		
		var vertexShaderString = document.getElementById('vertexshader').value;
		var fragmentShaderString = document.getElementById('fragmentshader').value;
		
		gl.shaderSource(
			vertexShader,
			"#ifdef GL_ES\nprecision highp float;\n#endif\n" +
			vertexShaderString);
		gl.compileShader(vertexShader);
		gl.attachShader(program, vertexShader);
		
		gl.shaderSource(
			fragmentShader,
			"#ifdef GL_ES\nprecision highp float;\n#endif\n" +
			fragmentShaderString);
		gl.compileShader(fragmentShader);
		gl.attachShader(program, fragmentShader);
		
		var positionAttribIndex = 0;
		
		gl.bindAttribLocation(program, positionAttribIndex, 'position');
		gl.linkProgram(program);
		
		gl.useProgram(program);
		
		var log = gl.getProgramInfoLog(program);
		if( log ) {
			alert('Link failed with error log:\n' + log);
		}
		
		gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
		gl.enableVertexAttribArray(positionAttribIndex);
		
		var kFloatSize = Float32Array.BYTES_PER_ELEMENT;
		gl.vertexAttribPointer(positionAttribIndex,
			3, gl.FLOAT, false, 3 * kFloatSize, 0 * kFloatSize);
		
		gl.drawElements(gl.TRIANGLES, 3, gl.UNSIGNED_SHORT, 0);
	}
</script>
</head>

<body onload="draw();">
<canvas id="mycanvas" height=300 width=400>
  canvas text
</canvas><br/>

<textarea id="vertexshader">
  attribute vec4 position;

  void main() {
    gl_Position = position;
  }
</textarea>

<textarea id="fragmentshader">
  void main() {
    gl_FragColor = vec4(1, 0, 0, 1);
  }
</textarea>


</body>

</html>

